table:
  name: DOUG_DEMO_V2.DBT_DGUTHRIE.ORDER_ITEMS
  description: Intermediate model where we calculate item price, discounts and tax. This model is at the order item level.
  dialect: snowflake
  casing-policy: preserve
  materialization: view
  purpose: model
  dependencies:
  - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS
  - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS
  depended-on-by:
  - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS
  - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDERS
  columns:
  - name: ORDER_ITEM_KEY
    description: surrogate key for the model -- combo of order_key + line_number
    datatype: varchar
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.ORDER_ITEM_KEY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ORDER_ITEM_KEY
  - name: ORDER_KEY
    description: foreign key for orders
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS.ORDER_KEY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ORDER_KEY
  - name: CUSTOMER_KEY
    description: foreign key for customers
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS.CUSTOMER_KEY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.CUSTOMER_KEY
  - name: PART_KEY
    description: foreign key for part
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.PART_KEY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.PART_KEY
  - name: SUPPLIER_KEY
    description: foreign key for suppliers
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.SUPPLIER_KEY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.SUPPLIER_KEY
  - name: ORDER_DATE
    description: date of the order
    datatype: date
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS.ORDER_DATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ORDER_DATE
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ORDER_DATE_PLUS_3_MONTHS
  - name: ORDER_STATUS_CODE
    description: status of the order
    datatype: varchar
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS.STATUS_CODE
  - name: RETURN_FLAG
    description: letter determining the status of the return
    datatype: varchar
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.RETURN_FLAG
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.RETURN_FLAG
  - name: LINE_NUMBER
    description: sequence of the order items within the order
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.LINE_NUMBER
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.LINE_NUMBER
  - name: ORDER_ITEM_STATUS_CODE
    description: status of the order item
    datatype: varchar
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.STATUS_CODE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ORDER_ITEM_STATUS_CODE
  - name: SHIP_DATE
    description: the date the order item is being shipped
    datatype: date
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.SHIP_DATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.SHIP_DATE
  - name: COMMIT_DATE
    description: the date the order item is being commited
    datatype: date
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.COMMIT_DATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.COMMIT_DATE
  - name: RECEIPT_DATE
    description: the receipt date of the order item
    datatype: date
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.RECEIPT_DATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.RECEIPT_DATE
  - name: SHIP_MODE
    description: method of shipping
    datatype: varchar
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.SHIP_MODE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.SHIP_MODE
  - name: EXTENDED_PRICE
    description: line item price
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
  - name: QUANTITY
    description: total units
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.QUANTITY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.QUANTITY
  - name: BASE_PRICE
    description: since extended_price is the line item total, we back out the price per item
    datatype: decimal(16, 4)
    lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.QUANTITY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.BASE_PRICE
  - name: DISCOUNT_PERCENTAGE
    description: percentage of the discount
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.DISCOUNT_PERCENTAGE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.DISCOUNT_PERCENTAGE
  - name: DISCOUNTED_PRICE
    description: factoring in the discount_percentage, the line item discount total
    datatype: decimal(16, 4)
    lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.DISCOUNT_PERCENTAGE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.QUANTITY
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.DISCOUNTED_PRICE
  - name: GROSS_ITEM_SALES_AMOUNT
    description: same as extended_price
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
    forward-lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.GROSS_ITEM_SALES_AMOUNT
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDERS.GROSS_ITEM_SALES_AMOUNT
  - name: DISCOUNTED_ITEM_SALES_AMOUNT
    description: line item (includes quantity) discount amount
    datatype: decimal(16, 4)
    lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.DISCOUNT_PERCENTAGE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.DISCOUNTED_ITEM_SALES_AMOUNT
  - name: ITEM_DISCOUNT_AMOUNT
    description: item level discount amount. this is always a negative number
    datatype: decimal(16, 4)
    lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.DISCOUNT_PERCENTAGE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ITEM_DISCOUNT_AMOUNT
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDERS.ITEM_DISCOUNT_AMOUNT
  - name: TAX_RATE
    description: tax rate of the order item
    datatype: decimal(38, 0)
    lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.TAX_RATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.TAX_RATE
  - name: ITEM_TAX_AMOUNT
    description: item level tax total
    datatype: decimal(16, 4)
    lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.DISCOUNT_PERCENTAGE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.TAX_RATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.ITEM_TAX_AMOUNT
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDERS.ITEM_TAX_AMOUNT
  - name: NET_ITEM_SALES_AMOUNT
    description: the net total which factors in discount and tax
    datatype: decimal(16, 4)
    lineage:
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.DISCOUNT_PERCENTAGE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.EXTENDED_PRICE
      - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.TAX_RATE
    forward-lineage:
      copy:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDER_ITEMS.NET_ITEM_SALES_AMOUNT
      modify:
      - DOUG_DEMO_V2.DBT_DGUTHRIE.FCT_ORDERS.NET_ITEM_SALES_AMOUNT
  lineage:
    scan:
    - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_LINE_ITEMS.ORDER_KEY
    - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS.ORDER_DATE
    - DOUG_DEMO_V2.DBT_DGUTHRIE.STG_TPCH_ORDERS.ORDER_KEY
  source-locations:
  - path: target/compiled/sdf/models/DOUG_DEMO_V2/DBT_DGUTHRIE/order_items.sdf.yml
  - path: target/compiled/sdf/models/DOUG_DEMO_V2/DBT_DGUTHRIE/order_items.sql
